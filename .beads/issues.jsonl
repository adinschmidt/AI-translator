{"id":"bd-77r","title":"Full-page translation overhaul v2","description":"Implement PLAN_v2.md: safe units, placeholder formatting, queue w/ backoff, fallbacks","status":"closed","priority":2,"issue_type":"epic","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:14.49524-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T23:04:23.541698-05:00","closed_at":"2026-01-24T23:04:23.541698-05:00","close_reason":"All 8 child tasks completed: safe unit collection, size splitting, placeholder serialization/validation, background translateUnit handler, TranslationQueue with concurrency/retry/cache, apply-to-DOM logic, UX progress states, and fallbacks. Build verified for Chrome/Firefox."}
{"id":"bd-77r.1","title":"Content: collect safe translation units","description":"Implement leaf-ish block unit selection + traversal filters; skip hidden/interactive; exclude extension UI","status":"closed","priority":2,"issue_type":"task","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:14.630611-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T22:55:00.856559-05:00","closed_at":"2026-01-24T22:55:00.856559-05:00","close_reason":"Implemented collectSafeTranslationUnits with SKIP_TAGS, INTERACTIVE_TAGS, BLOCK_LEVEL_TAGS, INLINE_SAFE_TAGS, EXTENSION_UI_SELECTORS constants and helper functions: isHiddenElement, isExtensionUI, containsInteractiveControls, containsNestedBlocks, isSafeTranslationUnit","dependencies":[{"issue_id":"bd-77r.1","depends_on_id":"bd-77r","type":"parent-child","created_at":"2026-01-24T22:51:14.631561-05:00","created_by":"Adin Schmidt"}]}
{"id":"bd-77r.2","title":"Content: unit size caps + splitting","description":"Add MAX_UNIT_CHARS/HARD_MAX_UNIT_CHARS; split oversized units by sentences/paragraphs with safe fallback","status":"closed","priority":2,"issue_type":"task","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:14.771796-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T22:56:34.851692-05:00","closed_at":"2026-01-24T22:56:34.851692-05:00","close_reason":"Added MAX_UNIT_CHARS (800) and HARD_MAX_UNIT_CHARS (2000) constants; implemented splitIntoSentences, splitTextIntoChunks, splitByWords, unitNeedsSplitting helper functions; updated collectSafeTranslationUnits to split oversized units with chunkIndex/totalChunks metadata","dependencies":[{"issue_id":"bd-77r.2","depends_on_id":"bd-77r","type":"parent-child","created_at":"2026-01-24T22:51:14.772716-05:00","created_by":"Adin Schmidt"},{"issue_id":"bd-77r.2","depends_on_id":"bd-77r.1","type":"blocks","created_at":"2026-01-24T22:51:15.694735-05:00","created_by":"Adin Schmidt"}]}
{"id":"bd-77r.3","title":"Content: placeholder serialization + validation","description":"Serialize units into placeholder-marked text; validate placeholder integrity in output; retry once with stricter prompt","status":"closed","priority":2,"issue_type":"task","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:14.908126-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T22:57:36.284662-05:00","closed_at":"2026-01-24T22:57:36.284662-05:00","close_reason":"Implemented placeholder serialization system: serializeUnitWithPlaceholders (walks DOM, emits paired markers like ⟦P0⟧/⟦/P0⟧), extractPlaceholderTokens, validatePlaceholders (checks input vs output), parsePlaceholderOutput (parses into segments), isOutputTruncated (detects truncation)","dependencies":[{"issue_id":"bd-77r.3","depends_on_id":"bd-77r","type":"parent-child","created_at":"2026-01-24T22:51:14.909844-05:00","created_by":"Adin Schmidt"},{"issue_id":"bd-77r.3","depends_on_id":"bd-77r.2","type":"blocks","created_at":"2026-01-24T22:51:15.796829-05:00","created_by":"Adin Schmidt"}]}
{"id":"bd-77r.4","title":"Background: translateUnit handler + prompts","description":"Add action=translateUnit handler; placeholder-safe system prompt; return text only (no markdown); set sane token cap","status":"closed","priority":2,"issue_type":"task","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:15.047542-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T22:59:28.292573-05:00","closed_at":"2026-01-24T22:59:28.292573-05:00","close_reason":"Added PLACEHOLDER_SAFE_SYSTEM_PROMPT, PLACEHOLDER_STRICT_SYSTEM_PROMPT, MAX_UNIT_TOKENS (1024) constants; added translateUnit message handler; implemented translateUnitText async function with placeholder-safe prompting and retry support with stricter prompt","dependencies":[{"issue_id":"bd-77r.4","depends_on_id":"bd-77r","type":"parent-child","created_at":"2026-01-24T22:51:15.048476-05:00","created_by":"Adin Schmidt"},{"issue_id":"bd-77r.4","depends_on_id":"bd-77r.3","type":"blocks","created_at":"2026-01-24T22:51:15.899112-05:00","created_by":"Adin Schmidt"}]}
{"id":"bd-77r.5","title":"Content: TranslationQueue (concurrency, retry/backoff, cache)","description":"Concurrency=3; per-unit timeout; retry 429/503/network w/ exponential backoff; cache key includes provider/model/instructions + serialized input","status":"closed","priority":2,"issue_type":"task","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:15.183961-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T23:00:41.533635-05:00","closed_at":"2026-01-24T23:00:41.533635-05:00","close_reason":"Implemented TranslationQueue class with: QUEUE_CONCURRENCY=3, QUEUE_TIMEOUT_MS=15000, QUEUE_MAX_RETRIES=3, QUEUE_BASE_BACKOFF_MS=1000; exponential backoff with jitter for 429/503/network errors; in-memory cache keyed by serialized input; progress callbacks; stop() method for cancellation","dependencies":[{"issue_id":"bd-77r.5","depends_on_id":"bd-77r","type":"parent-child","created_at":"2026-01-24T22:51:15.184883-05:00","created_by":"Adin Schmidt"},{"issue_id":"bd-77r.5","depends_on_id":"bd-77r.4","type":"blocks","created_at":"2026-01-24T22:51:16.001113-05:00","created_by":"Adin Schmidt"}]}
{"id":"bd-77r.6","title":"Content: apply translation via text node updates","description":"Parse placeholder output and update existing text nodes while preserving inline DOM nodes (avoid innerHTML writes)","status":"closed","priority":2,"issue_type":"task","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:15.319603-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T23:01:56.710743-05:00","closed_at":"2026-01-24T23:01:56.710743-05:00","close_reason":"Implemented applyTranslationToUnit() which parses placeholder output and updates text nodes proportionally while preserving DOM structure; added applyPlainTextFallback() for simple cases; distributes translated text across multiple text nodes based on original length proportions","dependencies":[{"issue_id":"bd-77r.6","depends_on_id":"bd-77r","type":"parent-child","created_at":"2026-01-24T22:51:15.320539-05:00","created_by":"Adin Schmidt"},{"issue_id":"bd-77r.6","depends_on_id":"bd-77r.5","type":"blocks","created_at":"2026-01-24T22:51:16.104673-05:00","created_by":"Adin Schmidt"}]}
{"id":"bd-77r.7","title":"UX: progress states + stop + error policy","description":"Preparing/translating/done/stopped states; stop cancels remaining work; summarize errors without console spam","status":"closed","priority":2,"issue_type":"task","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:15.457155-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T23:03:37.350434-05:00","closed_at":"2026-01-24T23:03:37.350434-05:00","close_reason":"Implemented translatePageV2() with TranslationQueue; displayLoadingIndicatorV2 with state-aware styling (preparing/translating/done/stopped/error); stopTranslationV2() wired to queue.stop(); progress callback updates; unit completion applies translation or marks errors; wired to startElementTranslation message handler","dependencies":[{"issue_id":"bd-77r.7","depends_on_id":"bd-77r","type":"parent-child","created_at":"2026-01-24T22:51:15.45803-05:00","created_by":"Adin Schmidt"},{"issue_id":"bd-77r.7","depends_on_id":"bd-77r.6","type":"blocks","created_at":"2026-01-24T22:51:16.208141-05:00","created_by":"Adin Schmidt"}]}
{"id":"bd-77r.8","title":"Fallback modes + cleanup + smoke tests","description":"Add text-only fallback; optional HTML fallback w/ strict DOMPurify safe-URI; remove old full-page HTML flow; run manual smoke checks","status":"closed","priority":2,"issue_type":"task","owner":"9936213+adinschmidt@users.noreply.github.com","created_at":"2026-01-24T22:51:15.592561-05:00","created_by":"Adin Schmidt","updated_at":"2026-01-24T23:04:08.066867-05:00","closed_at":"2026-01-24T23:04:08.066867-05:00","close_reason":"Text-only fallback via applyPlainTextFallback already implemented; fallback used when applyTranslationToUnit returns false; old translatePageElements kept but deprecated (v2 is now default); build succeeds for both Chrome and Firefox","dependencies":[{"issue_id":"bd-77r.8","depends_on_id":"bd-77r","type":"parent-child","created_at":"2026-01-24T22:51:15.593443-05:00","created_by":"Adin Schmidt"},{"issue_id":"bd-77r.8","depends_on_id":"bd-77r.7","type":"blocks","created_at":"2026-01-24T22:51:16.309933-05:00","created_by":"Adin Schmidt"}]}
